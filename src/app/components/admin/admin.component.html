<div class="container" style="font-family: Montserrat;">
  <div class="card mx-auto shadow-lg border mt-5 mb-5 border-0 rounded-5 p-3">
    <div class="row">
      <div class="col-md-12 ps-5 pt-3">
        <h4 class="display-6 text-muted">
          <span class="text-body-tertiary"><i class="bi bi-person"></i> Bienvenido, </span>
          {{user.name.toLowerCase() | titlecase}}
        </h4>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="col-md-3 ps-5 pe-4 pt-4">
        <div class="d-grid gap-2 mb-5">
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/orders"><i class="bi bi-file-earmark-text">
              Pedidos</i></a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/products"><i class="bi bi-boxes"> Productos</i>
            </a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/stock"><i class="bi bi-box"> Stock</i></a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/report"><i class="bi bi-bar-chart-line">
              Reportes</i></a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/support"><i class="bi bi-gear-wide-connected">
                Soporte</i></a>
          <a class="btn btn-primary btn-lg boton p-3" (click)="logout()"><i class="bi bi-box-arrow-right"> Cerrar
              sesion</i></a>
        </div>
      </div>

      <!--Mostrar pedidos-->
      <div class="col-md-9">
        <div class="m-3 p-3">
          <div class="row pb-4">
            <div class="col-md-12 text-center">
              <h4 class="text-muted fw-bold text-body-tertiary fs-3">
                <span class="rounded-5"><i class="bi bi-file-earmark-text"></i>Pedidos</span>
              </h4>
            </div>
          </div>
          <div class="row pb-4 align-items-start d-flex justify-content-start">
            <form action="#" class="col-md-12 row p-3 bg-dark bg-opacity-10 border rounded-5" (ngSubmit)="getOrders()" [formGroup]="formOrders">
              <div class="col-md-3">
                <label for="validationCustom01" class="form-label">Fecha Desde</label>
                <input type="datetime-local" class="form-control rounded-5" formControlName="fromDate">
              </div>
              <div class="col-md-3">
                <label for="validationCustom01" class="form-label">Fecha Hasta</label>
                <input type="datetime-local" class="form-control rounded-5" formControlName="toDate">
              </div>
              <div class="col-md-3">
                <label for="validationCustom01" class="form-label"> Estado</label>
                <select name="estado" id="estado" class="form-select rounded-5" formControlName="status">
                  <option value="0">Cualquiera</option>
                  <option value="1">Aprobado</option>
                  <option value="2">Pendiente</option>
                  <option value="4">En proceso</option>
                </select>
              </div>
              <div class="col-md-3 align-self-end">
                <button class="btn btn-primary border-0 p-2 ps-3 pe-3 rounded-4"
                  style="background-color: #86BB3C; opacity: 0.9;" type="submit"><i class="bi bi-search"> Buscar</i> </button>
              </div>
            </form>
          </div>
          <div class="row mb-3">
            <div class="col-md-4">
              <p class="text-muted">{{orders.length}} Resultados</p> 
            </div>
            <div class="col-md-4"></div>
            <div class="col-md-4">
              <select class="form-select rounded-5" (change)="orderBy($event)">
                <option class="form-select text-muted" selected disabled>Ordenar pedidos por</option>
                <option class="form-select text-muted" value="reciente">Mas recientes</option>
                <option class="form-select text-muted" value="antiguo">Mas antiguos</option>
              </select>
            </div>
          </div>
          
          <div class="row">
            <div class="accordion accordion-flush" id="accordionFlushExample">
              <ng-container *ngIf="orders.length > 0; else noOrders">
                <div class="accordion-item bg-primary-subtle bg-opacity-50 rounded-5"
                  *ngFor="let order of orders; let i = index">
                  <h5 class="accordion-header">
                    <button class="accordion-button collapsed btn" type="button" data-bs-toggle="collapse"
                      [attr.data-bs-target]="'#collapse-' + order.id" aria-expanded="false"
                      [attr.aria-controls]="'collapse-' + order.id">
                      <div class="row mb-0">
                        <div class="col-md-4">
                          <p class="text-muted">Fecha</p>
                        </div>
                        <div class="col-md-4">
                          <p class="text-muted">Estado de pago</p>
                        </div>
                        <div class="col-md-4">
                          <p class="text-muted">Total</p>
                        </div>
                        <div class="col-md-4">
                          <i class="bi bi-calendar text-primary"></i> <span class="text-primary"> {{order.date}}</span>
                        </div>
                        <div class="col-md-4">
                          <div *ngIf="order.status === 'Aprobado'">
                            <p><i class="bi bi-check-circle-fill text-success"> Aprobado</i></p>
                          </div>
                          <div *ngIf="order.status === 'Pendiente'">
                            <p><i class="bi bi-exclamation-triangle-fill text-secondary"> Pendiente</i></p>
                          </div>
                          <div *ngIf="order.status === 'En proceso'">
                            <p><i class="bi bi-hourglass-split text-warning"> En proceso</i></p>
                          </div>
                        </div>
                        <div class="col-md-4">
                          <p><i class="bi bi-cash-coin"></i> {{getTotal(i) | currency}}</p>
                        </div>
                      </div>
                    </button>
                  </h5>
                  <div [id]="'collapse-' + order.id" class="accordion-collapse collapse"
                    [attr.data-bs-parent]="'#accordionFlushExample'">
                    <div class="accordion-body">
                      <div class="row">
                        <div class="col-md-4">
                          <p><i class="bi bi-hash"></i> {{order.id_payment}}</p>
                        </div>
                        <div class="col-md-4">
                          <p><i class="bi bi-truck text-secondary"></i> {{order.shipping}} </p>
                        </div>
                        <div class="col-md-4">
                          <p><i class="bi bi-wallet2 text-success"></i> {{order.format_payment | titlecase}} </p>
                        </div>
                      </div>
                      <div class="row p-1">
                        <hr>
                        <div class="col-md-12">
                          <h5>Cliente</h5>
                        </div>
                        <div class="col-md-4 text-start">
                          <p><i class="bi bi-person-fill"></i> {{order.user.name}}, {{order.user.lastname}}</p>
                        </div>
                        <div class="col-md-3 text-start">
                          <p><i class="bi bi-telephone-fill"></i> {{order.user.phone}}</p>
                        </div>
                        <div class="col-md-5 text-start">
                          <p><i class="bi bi-envelope-fill"></i> {{order.user.email}}</p>
                        </div>
                        <div class="col-md-4 text-start">
                          <p><i class="bi bi-geo-alt-fill"></i> {{getProvince(order.user.province)}} - {{order.user.city}}</p>
                        </div>
                        <div class="col-md-4 text-start">
                          <p><i class="bi bi-house-door-fill"></i> {{order.user.address}} &nbsp; Piso: {{order.user.floor}} Dep: {{order.user.departament}}</p>
                        </div>
                      </div>
                      <div class="row">
                        <hr>
                        <div class="col-md-12 mb-3">
                          <h5>Detalles de los productos</h5>
                        </div>
                        <div class="col-md-12" *ngFor="let product of order.orderDetails">
                          <div class="row">
                            <div class="col-md-2">
                              <p class="text-muted opacity-50">{{product.product.code}}</p>
                            </div>
                            <div class="col-md-4">
                              <p>{{product.product.name | titlecase}} </p>
                            </div>
                            <div class="col-md-1">
                              <p>X {{product.quantity}}</p>
                            </div>
                            <div class="col-md-2">
                              <p>c/u {{product.price | currency}}</p>
                            </div>
                            <div class="col-md-3">
                              <p class="text-end fw-semibold">Subtotal: {{product.price * product.quantity | currency}}
                              </p>
                            </div>
                          </div>
                        </div>
                        <hr>
                        <div class="col-md-12">
                          <p class="text-end fs-6 fw-bold">Total: {{getTotal(i) | currency}}</p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </ng-container>
              <ng-template #noOrders>
                <div class="text-end mt-5 fs-5">
                  <p class="text-center"><i class="bi bi-info-circle me-1"></i> No hay resultados que coincidan con su búsqueda.</p>
                </div>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>