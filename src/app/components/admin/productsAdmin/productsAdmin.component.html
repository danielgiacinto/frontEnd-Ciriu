<div class="container" style="font-family: Montserrat;">
  <div class="card mx-auto shadow-lg border mt-5 mb-5 border-0 rounded-5 p-4">
    <div class="row">
      <div class="col-md-1 col-2 text-center d-block d-lg-none">
        <button class="btn btn-lg text-muted" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasWithBothOptions" aria-controls="offcanvasWithBothOptions">
          <i class="bi bi-list"></i>
        </button>
        <div class="offcanvas offcanvas-start border-0" data-bs-scroll="true" tabindex="-1" id="offcanvasWithBothOptions" aria-labelledby="offcanvasWithBothOptionsLabel">
          <div class="offcanvas-header">
            <h5 class="offcanvas-title display-6 text-body-tertiary" id="offcanvasWithBothOptionsLabel">Menu</h5>
            <button type="button" class="btn-close" style="box-shadow: none;" data-bs-dismiss="offcanvas" aria-label="Close"></button>
          </div>
          <div class="offcanvas-body">
            <div class="d-grid gap-2">
              <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/orders" data-bs-dismiss="offcanvas"><i class="bi bi-file-earmark-text">
                  Pedidos</i></a>
              <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/products" data-bs-dismiss="offcanvas"><i class="bi bi-boxes"> Productos</i>
                </a>
              <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/stock" data-bs-dismiss="offcanvas"><i class="bi bi-box"> Stock</i></a>
              <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/report" data-bs-dismiss="offcanvas"><i class="bi bi-bar-chart-line">
                  Reportes</i></a>
              <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/support" data-bs-dismiss="offcanvas"><i class="bi bi-gear-wide-connected">
                    Soporte</i></a>
              <a class="btn btn-primary btn-lg boton p-3" (click)="logout()"><i class="bi bi-box-arrow-right"> Cerrar
                  sesion</i></a>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-11 col-10 mt-1">
        <h4 class="display-6 text-muted">
          <span class="text-body-tertiary"><i class="bi bi-person"></i>Hola, </span> {{user.name.toLowerCase() | titlecase}}
        </h4>
      </div>
    </div>
    <hr>
    <div class="row">
      <div class="pt-4 col-lg-2 d-none d-lg-block">
        <div class="d-grid gap-2 mb-5">
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/orders"><i class="bi bi-file-earmark-text">
              Pedidos</i></a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/products"><i class="bi bi-boxes"> Productos</i>
            </a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/stock"><i class="bi bi-box"> Stock</i></a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/report"><i class="bi bi-bar-chart-line">
              Reportes</i></a>
          <a class="btn btn-primary btn-lg boton p-3" routerLink="/admin/support"><i class="bi bi-gear-wide-connected">
                Soporte</i></a>
          <a class="btn btn-primary btn-lg boton p-3" (click)="logout()"><i class="bi bi-box-arrow-right"> Cerrar
              sesion</i></a>
        </div>
      </div>
      <!--Mostrar productos -->
      <div class="col-12 col-lg-10 col-sm-12 col-xs-12">
        <div class="m-4">
          <div class="row pb-4">
            <div class="col-md-12 text-center">
              <h4 class="text-muted fw-bold text-body-tertiary fs-3">
                <span class="rounded-5"><i class="bi bi-boxes"></i> Productos</span>
              </h4>
            </div>
          </div>
          <div class="row pb-4 pt-2">
            <div class="card shadow border-0 rounded-5 p-3">
              <div class="row align-items-center">
                <div class="col-md-6 mb-4 justify-content-center align-self-center text-center">
                  <button type="button" title="Añadir producto" class="btn btn-lg custom-button shadow" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                    <i class="bi bi-plus-circle"></i> Nuevo producto
                  </button>
                </div>
                <div class="col-md-6  mb-4 justify-content-center align-self-center text-center">
                  <button type="button" title="Papelera" class="btn btn-lg custom-button shadow" data-bs-toggle="modal" data-bs-target="#trashModal">
                    <i class="bi bi-trash3"></i> Papelera
                  </button>
                </div>
              </div> 
              
            </div>
            
          </div>
          <div class="row pb-2">

            <div class="col-md-5 col-11 m-0 p-0 col-xs-12">
              <div class="input-group mb-3 rounded-5 bg-secondary-subtle">
                <button class="btn btn-lg btn-link-light text-white border-0" style="cursor:default;"><i class="bi bi-search"></i></button>
                <input type="text" id="searchProducts" class="form-control rounded-end-5" style="box-shadow: none;" placeholder="Buscar productos, marcas y más..."
                  aria-describedby="button-addon2" (input)="searchProducts($event)">
              </div>
            </div>

            <div class="col-md-3 col-6 pe-5 mb-3">
              <select class="form-select rounded-5" style="box-shadow: none;" (change)="orderProducts($event)">
                <option class="form-select text-muted" selected disabled>Ordenar</option>
                <option value="default" class="form-select text-muted">Por defecto</option>
                <option class="form-select text-muted" value="asc">Menor precio</option>
                <option class="form-select text-muted" value="desc">Mayor precio</option>
              </select>
            </div>
            <div class="col-md-3 mb-3 col-6 align-self-center form-check form-switch form-check-center">
              <input class="form-check-input fs-5" style="box-shadow: none; outline: none;" type="checkbox" role="switch" id="flexSwitchCheckDefault"
                (change)="filterByNonStock($event)">
              <label class="form-check-label text-muted mt-1" class="form-label fs-5 text-danger fw-semibold"for="flexSwitchCheckDefault">Sin stock</label>
            </div>

            <!--Nuevo producto-->
            <div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
              aria-labelledby="staticBackdropLabel" aria-hidden="true">
              <div class="modal-dialog modal-dialog-centered modal-lg">
                <div class="modal-content container-fluid border-0 rounded-5 p-2">
                  <div class="modal-header border-0">
                    <h1 class="modal-title fs-4 text-success" id="staticBackdropLabel"><i
                        class="bi bi-folder-plus fs-4 pe-2"></i> Nuevo producto</h1>
                    <button type="button" class="btn-close" style="box-shadow: none;" (click)="clearForm()" data-bs-dismiss="modal"
                      aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <form [formGroup]="formNewToy" class="text-center" (ngSubmit)="newToy()">
                      <div class="row">
                        <div class="col-md-12 mt-0">
                          <p class="text-muted text-start">Complete los siguientes campos para crear un nuevo producto. 
                            En el caso que el producto no cuente con una marca dejar el campo vacío.</p>
                        </div>
                        <!-- Codigo-->
                        <div class="col-md-5 mb-4">
                          <div class="input-group">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-list-ol"></i></span>
                            <input type="text" class="form-control" formControlName="code" placeholder="Codigo"
                              [ngClass]="{'is-invalid': formNewToy.get('code')?.errors 
                            && (formNewToy.get('code')?.dirty || formNewToy.get('code')?.touched) && 'is-invalid'}">
                          </div>
                          <div
                            *ngIf="formNewToy.get('code')?.invalid && (formNewToy.get('code')?.dirty || formNewToy.get('code')?.touched)">
                            <p class="text-danger"> Debe ingresar un código válido que no sea de otro producto</p>
                          </div>
                        </div>
                        <!-- Nombre-->
                        <div class="col-md-7 mb-4">
                          <div class="input-group">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-chat"></i></span>
                            <input type="text" class="form-control" formControlName="name" placeholder="Nombre"
                              [ngClass]="{'is-invalid': formNewToy.get('name')?.errors 
                            && (formNewToy.get('name')?.dirty || formNewToy.get('name')?.touched) && 'is-invalid'}">
                          </div>
                          <div
                            *ngIf="formNewToy.get('name')?.invalid && (formNewToy.get('name')?.dirty || formNewToy.get('name')?.touched)">
                            <p class="text-danger"> Debe ingresar un nombre de producto</p>
                          </div>
                        </div>
                        <!-- Categoria -->
                        <div class="col-md-5 mb-4">
                          <div class="input-group">
                            <label class="input-group-text" for="inputGroupSelect01"><i
                                class="bi bi-c-circle-fill"></i></label>
                            <select class="form-select text-muted" id="inputGroupSelect01" formControlName="category"
                              (change)="onCategoryChange($event)"
                              [ngClass]="{'is-invalid': formNewToy.get('category')?.errors 
                            && (formNewToy.get('category')?.dirty || formNewToy.get('category')?.touched) && 'is-invalid'}">
                              <option value="" disabled selected> Categoria</option>
                              <option *ngFor="let category of categories | sortBy: 'category'" [value]="category.id">{{category.category | titlecase}}
                              </option> 
                            </select>
                          </div>
                          <div
                            *ngIf="formNewToy.get('category')?.invalid && (formNewToy.get('category')?.dirty || formNewToy.get('category')?.touched)">
                            <p class="text-danger"> Debe seleccionar una categoria</p>
                          </div>
                        </div>
                        <div class="col-md-1 mb-2">
                          <p class="d-inline-flex gap-1">
                            <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#categoria" aria-expanded="false" aria-controls="collapseWidthExample">
                              <i class="bi bi-plus-circle text-success"></i>
                            </button>
                          </p>
                          <div class="row">
                            <div class="col">
                              <div class="collapse multi-collapse" id="categoria">
                                <div class="card card-body" style="width: 350px;">
                                  <app-newCategory></app-newCategory>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        
                        <!--Sub Categoria-->
                        <div class="col-md-5 mb-4">
                          <div class="input-group">
                            <label class="input-group-text" for="inputGroupSelect01"><i
                                class="bi bi-c-circle-fill"></i></label>
                            <select class="form-select text-muted" id="inputSubCategory" formControlName="subcategory"
                              [ngClass]="{'is-invalid': formNewToy.get('sub_category')?.errors 
                          && (formNewToy.get('subcategory')?.dirty || formNewToy.get('subcategory')?.touched) && 'is-invalid'}">
                              <option value="" disabled selected> Sub categoria</option>
                              <option *ngFor="let subCategory of subCategories | sortBy: 'subcategory'" [value]="subCategory.id">
                                {{subCategory.subcategory | titlecase}}</option>
                            </select>
                          </div>
                          <div
                            *ngIf="formNewToy.get('subcategory')?.invalid && (formNewToy.get('subcategory')?.dirty || formNewToy.get('subcategory')?.touched)">
                            <p class="text-danger"> Debe seleccionar una sub categoria</p>
                          </div>
                        </div>
                        <div class="col-md-1 mb-2">
                          <p class="d-inline-flex gap-1">
                            <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#subcategoria" aria-expanded="false" aria-controls="collapseWidthExample">
                              <i class="bi bi-plus-circle text-success"></i>
                            </button>
                          </p>
                          <div class="row">
                            <div class="col">
                              <div class="collapse multi-collapse" id="subcategoria">
                                <div class="card card-body" style="width: 350px;">
                                  <app-newSubcategory></app-newSubcategory>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>

                        <!--Sub Categoria 2-->
                        <div class="col-md-5 mb-4">
                          <div class="input-group">
                            <label class="input-group-text" for="inputGroupSelect01"><i
                                class="bi bi-c-circle-fill"></i></label>
                            <select class="form-select text-muted" id="inputSubCategory" formControlName="subcategory2"
                              [ngClass]="{'is-invalid': formNewToy.get('subcategory2')?.errors 
                          && (formNewToy.get('subcategory2')?.dirty || formNewToy.get('subcategory2')?.touched) && 'is-invalid'}">
                              <option value="" disabled selected> Sub categoria</option>
                              <option *ngFor="let subCategory of subCategories | sortBy: 'subcategory'" [value]="subCategory.id">
                                {{subCategory.subcategory | titlecase}}</option>
                            </select>
                          </div>
                        </div>
                        <!-- Marca -->
                        <div class=" col-md-4 mb-4">
                          <div class="input-group">
                            <label class="input-group-text" for="inputGroupSelect01"><i
                                class="bi bi-tag-fill"></i></label>
                            <select class="form-select text-muted" id="inputGroupSelect01" formControlName="brand"
                              [ngClass]="{'is-invalid': formNewToy.get('brand')?.errors 
                          && (formNewToy.get('brand')?.dirty || formNewToy.get('brand')?.touched) && 'is-invalid'}">
                              <option value="" disabled selected> Marca</option>
                              <option *ngFor="let brand of brands | sortBy: 'brand'" [value]="brand.id">{{brand.brand | titlecase}}</option>
                            </select>
                          </div>
                          <div
                            *ngIf="formNewToy.get('brand')?.invalid && (formNewToy.get('brand')?.dirty || formNewToy.get('brand')?.touched)">
                            <p class="text-danger"> Seleccione una marca</p>
                          </div>
                        </div>
                        <div class="col-md-1 mb-2">
                          <p class="d-inline-flex gap-1">
                            <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#marca" aria-expanded="false" aria-controls="collapseWidthExample">
                              <i class="bi bi-plus-circle text-success"></i>
                            </button>
                          </p>
                          <div class="row">
                            <div class="col">
                              <div class="collapse multi-collapse" id="marca">
                                <div class="card card-body" style="width: 350px;">
                                  <app-newBrand></app-newBrand>
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                        <!--Precio-->
                        <div class="col-md-4 mb-4">
                          <div class="input-group">
                            <span class="input-group-text" id="basic-addon1"><i
                                class="bi bi-currency-dollar"></i></span>
                            <input type="number" class="form-control" formControlName="price" placeholder="Precio"
                              [ngClass]="{'is-invalid': formNewToy.get('price')?.errors 
                            && (formNewToy.get('price')?.dirty || formNewToy.get('price')?.touched) && 'is-invalid'}">
                          </div>
                          <div
                            *ngIf="formNewToy.get('price')?.invalid && (formNewToy.get('price')?.dirty || formNewToy.get('price')?.touched)">
                            <p class="text-danger"> Debe definir un precio</p>
                          </div>
                        </div>
                        
                        <!-- Stock -->
                        <div class="col-md-3 mb-4">
                          <div class="input-group">
                            <span class="input-group-text" id="basic-addon1"><i class="bi bi-123"></i></span>
                            <input type="number" class="form-control" formControlName="stock" placeholder="Stock"
                              [ngClass]="{'is-invalid': formNewToy.get('stock')?.errors 
                            && (formNewToy.get('stock')?.dirty || formNewToy.get('stock')?.touched) && 'is-invalid'}">
                          </div>
                          <div
                            *ngIf="formNewToy.get('stock')?.invalid && (formNewToy.get('stock')?.dirty || formNewToy.get('stock')?.touched)">
                            <p class="text-danger"> Debe ingresar un stock</p>
                          </div>
                        </div>
                        <!--Descripcion-->
                        <div class="col-md-12 mb-4">
                          <div class="input-group">
                            <span class="input-group-text"><i class="bi bi-chat"></i></span>
                            <textarea class="form-control" aria-label="With textarea" placeholder="Descripcion..."
                              formControlName="description" rows="6"
                              [ngClass]="{'is-invalid': formNewToy.get('description')?.errors 
                              && (formNewToy.get('description')?.dirty || formNewToy.get('description')?.touched) && 'is-invalid'}">
                            </textarea>
                          </div>
                          <div
                            *ngIf="formNewToy.get('description')?.invalid && (formNewToy.get('description')?.dirty || formNewToy.get('description')?.touched)">
                            <p class="text-danger"> Debe escribir una descripcion</p>
                          </div>
                        </div>
                        <!-- Imagen -->
                        <div formArrayName="image">
                          <p class="text-muted text-start pb-3">Por favor ingrese las urls de las imagenes que desea para este producto, haga click <a href="https://imgur.com/upload" class="text-decoration-none" rel="noreferrer noopener" target="_blank">aquí</a> para subir su foto y copiar la dirección de la imagen. </p>

                          <div class="col-md-10" *ngFor="let img of images.controls; let i=index">
                            <div class="d-flex justify-content-center mb-3">
                              <div class="input-group">
                                <span class="input-group-text" id="basic-addon1"><i class="bi bi-image"></i></span>
                                <input id="alias-{{ i }}" type="text" [formControlName]="i" class="form-control"
                                  placeholder="Url de la imagen">
                                <div class="input-group-append">
                                  <button type="button" class="btn btn-outline-danger ms-2" (click)="removeImage(i)"><i
                                      class="bi bi-trash"></i></button>
                                </div>
                              </div>
                            </div>
                            <!-- <div
                              *ngIf="formNewToy.get('image.' + i)?.invalid && (formNewToy.get('image.' + i)?.dirty || formNewToy.get('image.' + i)?.touched)">
                              <p class="text-danger text-center">Debe ingresar la URL de la imagen</p>
                            </div> -->
                          </div>
                          <div class="col-md-12 text-start mb-3 ps-5">
                            <button type="button" class="btn btn-outline-success" (click)="addImage()">+ Agregar Url</button>
                          </div>
                        </div>
                      </div>

                      <div class="modal-footer border-0">
                        <button type="button" class="btn btn-secondary rounded-5 shadow" (click)="clearForm()"
                          data-bs-dismiss="modal"><i class="bi bi-x-circle-fill text-white"></i> Cancelar</button>
                        <button type="submit" class="btn btn-primary rounded-5 shadow boton"
                          [disabled]="formNewToy.invalid || guardandoCambios">
                          <span *ngIf="!guardandoCambios">
                            <i class="bi bi-floppy2-fill"></i> Guardar cambios
                          </span>
                          <span *ngIf="guardandoCambios">
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            Guardando...
                          </span>
                        </button>
                      </div>
                      
                    </form>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!--Total resultados-->
          <div class="row mb-3 mt-2">
            <div class="col-md-12">
              <h6 class="fw-light fs-5 text-muted">{{totalElements}} Resultados</h6>
            </div>
          </div>
          <!-- Productos -->
          <div class="row">
            <div class="col-md-12 col-12">
              <div class="table-responsive">
                <table class="table table-striped-columns table-borderless">
                  <thead>
                    <tr class="table-dark opacity-50">
                      <th scope="col">Producto</th>
                      <th scope="col">Caracteristicas</th>
                      <th scope="col">Detalles</th>
                      <th scope="col">Acciones</th>
                    </tr>
                  </thead>

                  <tbody *ngIf="!isLoading">
                    <tr *ngFor="let toy of toys" style="border-bottom: 1px solid rgba(0, 0, 0, 0.25);">
                      <th scope="row" class="align-middle text-center p-0 m-0">
                        <img src="{{toy.image}}" width="90px" class="img-fluid rounded shadow" style="cursor: pointer;" height="auto" alt="producto" routerLink="/products/{{toy.code}}">
                      </th>
                      <td scope="row" class="align-middle">
                        <p>Código: {{toy.code}}</p>
                        <p>Nombre: {{toy.name}}</p>
                        <p>Marca: {{toy.brand | titlecase}}</p>
                        <p>Categoría: {{toy.category | titlecase}} | {{toy.subcategory | titlecase}} <span *ngIf="toy.subcategory2"> / {{toy.subcategory2 | titlecase}}</span></p>
                      </td>
                      <td scope="row" class="align-middle">
                        <p class="fs-5">Precio: {{'$ ' + (toy.price | number:'1.2-2')}}</p>
                        <p class="fs-5">Stock: {{toy.stock}}</p>
                      </td>
                      <td scope="row mt-5" class="align-middle text-center">
                        <div class="col mb-2">
                          <button class="btn btn-primary border-0 rounded-5 me-2 mb-2 fw-semibold" style="background-color: #379ec7; opacity: 0.9;" data-bs-toggle="modal"
                          data-bs-target="#exampleModal2" (click)="setSelectedCodeProduct(toy.code)"><i class="bi bi-arrow-down-up"> Stock</i>
                        </button>
                        </div>
                        <div class="col mb-2">
                          <button type="button" title="Editar" class="btn btn-primary border-0 rounded-5 me-2 mb-2 fw-semibold"
                            style="background-color: #FFD27C;" data-bs-toggle="modal" data-bs-target="#exampleModal"
                            (click)="getToyEdit(toy.code)">
                            <i class="bi bi-pencil-fill"> Editar</i>
                          </button>
                        </div>
                        <div class="col mb-2">
                          <button type="button" title="Eliminar" (click)="deleteProduct(toy.code)"
                          class="btn btn-primary border-0 rounded-5 me-2 mb-2 fw-semibold" style="background-color: #FF8383;"><i
                            class="bi bi-trash"> Borrar</i>
                        </button>
                        </div>
                      </td>
                    </tr>
                  </tbody>
                </table>

                <div *ngIf="isLoading" class="loader-container">
                  <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Cargando...</span>
                  </div>
                  <p class="text-muted mt-3">Cargando productos...</p>
                </div>
              </div>
              
            </div>
          </div>

          <!-- Editar producto -->
          <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel"
            aria-hidden="true">
            <div class="modal-dialog modal-lg modal-dialog-centered">
              <div class="modal-content rounded-5 border-0 p-2">
                <div class="modal-header border-0">
                  <h1 class="modal-title fs-4 text-warning" id="staticBackdropLabel"><i class="bi bi-pencil-fill"></i>
                    Editar producto</h1>
                  <button type="button" class="btn-close" style="box-shadow: none;" (click)="clearForm()" data-bs-dismiss="modal"
                    aria-label="Close"></button>
                </div>
                <div class="modal-body">
                  <form [formGroup]="formEditToy" (ngSubmit)="editToy()">
                    <div class="row">
                      <div class="col-md-12">
                        <p class="text-muted">Edite los siguientes campos para actualizar el producto</p>
                      </div>
                      <!-- Codigo-->
                      <div class="col-md-5 mb-4">
                        <div class="input-group">
                          <span class="input-group-text" id="basic-addon1"><i class="bi bi-list-ol"></i></span>
                          <input type="text" class="form-control" formControlName="codeEdit" placeholder="Codigo"
                            [ngClass]="{'is-invalid': formNewToy.get('code')?.errors 
                          && (formNewToy.get('codeEdit')?.dirty || formNewToy.get('codeEdit')?.touched) && 'is-invalid'}">
                        </div>
                        <div
                          *ngIf="formNewToy.get('codeEdit')?.invalid && (formNewToy.get('codeEdit')?.dirty || formNewToy.get('codeEdit')?.touched)">
                          <p class="text-danger"> Debe ingresar un código válido que no sea de otro producto</p>
                        </div>
                      </div>
                      <!-- Nombre-->
                      <div class="col-md-7 mb-4">
                        <div class="input-group">
                          <span class="input-group-text" id="basic-addon1"><i class="bi bi-chat"></i></span>
                          <input type="text" class="form-control" formControlName="nameEdit" placeholder="Nombre"
                            [ngClass]="{'is-invalid': formEditToy.get('name')?.errors 
                          && (formEditToy.get('nameEdit')?.dirty || formEditToy.get('nameEdit')?.touched) && 'is-invalid'}">
                        </div>
                        <div
                          *ngIf="formEditToy.get('nameEdit')?.invalid && (formEditToy.get('nameEdit')?.dirty || formEditToy.get('nameEdit')?.touched)">
                          <p class="text-danger"> Debe ingresar un nombre de producto</p>
                        </div>
                      </div>
                      <!--Precio-->
                      <div class="col-md-5 mb-4">
                        <div class="input-group">
                          <span class="input-group-text" id="basic-addon1"><i class="bi bi-currency-dollar"></i></span>
                          <input type="number" class="form-control" formControlName="priceEdit" placeholder="Precio"
                            [ngClass]="{'is-invalid': formEditToy.get('priceEdit')?.errors 
                          && (formEditToy.get('priceEdit')?.dirty || formEditToy.get('priceEdit')?.touched) && 'is-invalid'}">
                        </div>
                        <div
                          *ngIf="formEditToy.get('priceEdit')?.invalid && (formEditToy.get('priceEdit')?.dirty || formEditToy.get('priceEdit')?.touched)">
                          <p class="text-danger"> Debe definir un precio</p>
                        </div>
                      </div>
                      <!-- Categoria -->
                      <div class="col-md-4 mb-4">
                        <div class="input-group">
                          <label class="input-group-text" for="inputGroupSelect01"><i
                              class="bi bi-c-circle-fill"></i></label>
                          <select class="form-select text-muted" id="inputGroupSelect01" formControlName="categoryEdit"
                            (change)="onCategoryChange($event)"
                            [ngClass]="{'is-invalid': formEditToy.get('categoryEdit')?.errors 
                          && (formEditToy.get('categoryEdit')?.dirty || formEditToy.get('categoryEdit')?.touched) && 'is-invalid'}">
                            <option value="" disabled selected> Categoria</option>
                            <option *ngFor="let category of categories | sortBy: 'category'" [value]="category.id">{{category.category | titlecase}}
                            </option>
                          </select>
                        </div>
                        <div
                          *ngIf="formEditToy.get('categoryEdit')?.invalid && (formEditToy.get('categoryEdit')?.dirty || formEditToy.get('categoryEdit')?.touched)">
                          <p class="text-danger"> Debe seleccionar una categoria</p>
                        </div>
                      </div>
                      <div class="col-md-1 mb-2">
                        <p class="d-inline-flex gap-1">
                          <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#categoria" aria-expanded="false" aria-controls="collapseWidthExample">
                            <i class="bi bi-plus-circle text-success"></i>
                          </button>
                        </p>
                        <div class="row">
                          <div class="col">
                            <div class="collapse multi-collapse" id="categoria">
                              <div class="card card-body" style="width: 350px;">
                                <app-newCategory></app-newCategory>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!--Sub Categoria-->
                      <div class="col-md-4 mb-4">
                        <div class="input-group">
                          <label class="input-group-text" for="inputGroupSelect01"><i
                              class="bi bi-c-circle-fill"></i></label>
                          <select class="form-select text-muted" id="inputSubCategory"
                            formControlName="subcategoryEdit"
                            [ngClass]="{'is-invalid': formEditToy.get('subcategoryEdit')?.errors 
                        && (formEditToy.get('subcategoryEdit')?.dirty || formEditToy.get('subcategoryEdit')?.touched) && 'is-invalid'}">
                            <option value="" disabled selected> Sub categoria</option>
                            <option *ngFor="let subCategory of subCategories | sortBy: 'subcategory'" [value]="subCategory.id">
                              {{subCategory.subcategory | titlecase}}</option>
                          </select>
                        </div>
                        <div
                          *ngIf="formEditToy.get('subcategoryEdit')?.invalid && (formEditToy.get('subcategoryEdit')?.dirty || formEditToy.get('subcategoryEdit')?.touched)">
                          <p class="text-danger"> Debe seleccionar una sub categoria</p>
                        </div>
                      </div>
                      <div class="col-md-1 mb-2">
                        <p class="d-inline-flex gap-1">
                          <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#subcategoria" aria-expanded="false" aria-controls="collapseWidthExample">
                            <i class="bi bi-plus-circle text-success"></i>
                          </button>
                        </p>
                        <div class="row">
                          <div class="col">
                            <div class="collapse multi-collapse" id="subcategoria">
                              <div class="card card-body" style="width: 350px;">
                                <app-newSubcategory></app-newSubcategory>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>

                      <!--Sub Categoria 2-->
                      <div class="col-md-4 mb-4">
                        <div class="input-group">
                          <label class="input-group-text" for="inputGroupSelect01"><i
                              class="bi bi-c-circle-fill"></i></label>
                          <select class="form-select text-muted" id="inputSubCategory"
                            formControlName="subcategoryEdit2"
                            [ngClass]="{'is-invalid': formEditToy.get('subcategoryEdit2')?.errors 
                        && (formEditToy.get('subcategoryEdit2')?.dirty || formEditToy.get('subcategoryEdit2')?.touched) && 'is-invalid'}">
                            <option value="" disabled selected> Sub categoria</option>
                            <option *ngFor="let subCategory of subCategories | sortBy: 'subcategory'" [value]="subCategory.id">
                              {{subCategory.subcategory | titlecase}}</option>
                          </select>
                        </div>
                      </div>
                      <!-- Marca -->
                      <div class=" col-md-4 mb-4">
                        <div class="input-group">
                          <label class="input-group-text" for="inputGroupSelect01"><i
                              class="bi bi-tag-fill"></i></label>
                          <select class="form-select text-muted" id="inputGroupSelect01" formControlName="brandEdit"
                            [ngClass]="{'is-invalid': formEditToy.get('brandEdit')?.errors 
                        && (formEditToy.get('brandEdit')?.dirty || formEditToy.get('brandEdit')?.touched) && 'is-invalid'}">
                            <option value="" disabled selected> Marca</option>
                            <option *ngFor="let brand of brands | sortBy: 'brand'" [value]="brand.id">{{brand.brand | titlecase}}</option>
                          </select>
                        </div>
                        <div
                          *ngIf="formEditToy.get('brandEdit')?.invalid && (formEditToy.get('brandEdit')?.dirty || formEditToy.get('brandEdit')?.touched)">
                          <p class="text-danger"> Seleccione una marca</p>
                        </div>
                      </div>
                      <div class="col-md-1 mb-2">
                        <p class="d-inline-flex gap-1">
                          <button class="btn" type="button" data-bs-toggle="collapse" data-bs-target="#marca" aria-expanded="false" aria-controls="collapseWidthExample">
                            <i class="bi bi-plus-circle text-success"></i>
                          </button>
                        </p>
                        <div class="row">
                          <div class="col">
                            <div class="collapse multi-collapse" id="marca">
                              <div class="card card-body" style="width: 350px;">
                                <app-newBrand></app-newBrand>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                      <!--Descripcion-->
                      <div class="col-md-12 mb-4">
                        <div class="input-group">
                          <span class="input-group-text"><i class="bi bi-chat"></i></span>
                          <textarea class="form-control" aria-label="With textarea" placeholder="Descripcion..."
                            formControlName="descriptionEdit" rows="6"
                            [ngClass]="{'is-invalid': formEditToy.get('descriptionEdit')?.errors 
                            && (formEditToy.get('descriptionEdit')?.dirty || formEditToy.get('descriptionEdit')?.touched) && 'is-invalid'}">
                          </textarea>
                        </div>
                        <div
                          *ngIf="formEditToy.get('descriptionEdit')?.invalid && (formEditToy.get('descriptionEdit')?.dirty || formEditToy.get('descriptionEdit')?.touched)">
                          <p class="text-danger"> Debe escribir una descripcion</p>
                        </div>
                      </div>
                      <!-- Imagen -->
                      <div formArrayName="imageEdit">
                        <p class="text-muted text-start pb-3">Por favor ingrese las urls de las imagenes que desea para este producto, haga click <a href="https://imgur.com/upload" class="text-decoration-none" rel="noreferrer noopener" target="_blank">aquí</a> para subir su foto y copiar la dirección de la imagen. </p>

                        <div class="col-md-10" *ngFor="let img of imagesEdit.controls; let i=index">
                          <div class="d-flex justify-content-center mb-3">
                            <div class="input-group">
                              <img src="{{img.value}}" alt="Image Preview" width="70" height="70" class="img-thumbnail">
                              <input id="alias-{{ i }}" type="text" [formControlName]="i" class="form-control" required
                                placeholder="Url de la imagen">
                              <div class="input-group-append align-self-center">
                                <button type="button" class="btn btn-outline-danger ms-2"
                                  (click)="removeImageEdit(i)"><i class="bi bi-trash"> Quitar foto</i></button>
                              </div>
                            </div>
                          </div>
                          <div
                            *ngIf="formEditToy.get('imageEdit.' + i)?.invalid && (formEditToy.get('imageEdit.' + i)?.dirty || formEditToy.get('imageEdit.' + i)?.touched)">
                            <p class="text-danger text-center">Debe ingresar la URL de la imagen</p>
                          </div>
                        </div>
                        <div class="col-md-12 text-start ps-5 mb-3">
                          <button type="button" class="btn btn-outline-success" (click)="addImageEdit()">+ Agregar
                            Foto</button>
                        </div>
                      </div>
                    </div>
                    <div class="modal-footer border-0">
                      <button type="button" class="btn btn-secondary rounded-5 shadow" (click)="clearForm()"
                        data-bs-dismiss="modal"><i class="bi bi-x-circle-fill text-white"></i> Cancelar</button>
                      <button type="submit" class="btn btn-primary boton rounded-5 shadow"
                        [disabled]="formEditToy.invalid || guardandoCambios">
                        <span *ngIf="!guardandoCambios">
                          <i class="bi bi-floppy2-fill"></i> Actualizar
                        </span>
                        <span *ngIf="guardandoCambios">
                          <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                          Actualizando...
                        </span>
                      </button>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
          <!--Navegacion-->
          <!-- <div class="row mt-3">
            <div class="col-md-12">
              <nav aria-label="Page navigation example">
                <ul class="pagination justify-content-center">
                  <li class="page-item" [class.disabled]="currentPage === 0">
                    <a class="page-link border-0 text-dark" routerLink="/admin/products" [queryParams]="{ page: currentPage - 1 }"
                      (click)="prevPage()"><i class="bi bi-chevron-left"> </i></a>
                  </li>
                  <li class="page-item">
                    <select class="form-select border-0 ms-1 focus-ring focus-ring-light" [(ngModel)]="currentPage" (change)="onPageChange($event)">
                      <option *ngFor="let pageNumber of getPageNumbers()" [ngValue]="pageNumber">{{ pageNumber + 1 }}</option>
                    </select>
                  </li>
                  <li class="page-item">
                    <a class="page-link border-0 text-dark" routerLink="/admin/products" [queryParams]="{ page: currentPage + 1 }"
                      (click)="nextPage()"><i class="bi bi-chevron-right"></i></a>
                  </li>
                </ul>
              </nav>
            </div>
          </div> -->
        </div>
      </div>
    </div>
  </div>
</div>





<!-- Registrar Movimiento -->
<div class="modal fade" id="exampleModal2" tabindex="-1" aria-labelledby="exampleModalLabel2" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content rounded-5 border-0 p-2">
      <div class="modal-header border-0">
        <h1 class="modal-title fs-5 text-muted" id="exampleModalLabel">Registrar movimiento</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
          <app-stock-movements [productCode]="selectedProductCode" (movementRegistered)="reloadData()"></app-stock-movements>
      </div>
    </div>
  </div>
</div>